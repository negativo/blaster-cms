!function($,window,document,undefined){function randomize(){var a=Math.floor(Math.round(10*Math.random())),b=Math.floor(Math.round(10*Math.random())),c=a+b;return[a,b,c]}var user={init:function(){console.log("dummy.js :5","user up"),this.captcha(),this.bindEvents()},captcha:function(){var a=$("#captcha-q"),b=randomize();a.html(b[0]+"+"+b[1])},bindEvents:function(){$("#user-token-api-request").submit(user.requestApiToken),$("#user-profile-form").submit(user.changeInfo),$("#user-profile-pwd").submit(user.changePassword),$("#avatar-uploader").on("change",function(){$("#avatar-submit").trigger("click")}),$("body").delegate(".avatar-container","click",function(){$("body").find("#avatar-uploader").trigger("click")}),$("body").find(".register-form").submit(user.register),$("body").on("click",".delete-user",user.deleteUser)},deleteUser:function(a){function b(){$.ajax({url:"/api/user/"+d.id,type:"DELETE",data:d,success:function(a){return a.err?toastr.error(a.err):(toastr.success(a.message),void(document.location.pathname.match(/\/admin\/users\/[A-Za-z0-9].+/)?window.location.replace("/admin/users"):c.parent().parent().slideUp()))}})}a.preventDefault(),a.stopPropagation();var c,d={id:"",deleteUserData:!1};d.id=$(this).data("id"),c=$(this),swal({title:"Are you sure?",text:"You will not be able to recover user: "+$(this).data("username"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){swal({title:"What about data?",text:"Would you give ownership of post/media/pages to the administrator?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, give to admin!",cancelButtonText:"No, delete all!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a?(d.deleteUserData=!1,b()):(d.deleteUserData=!0,b())})})},register:function(e){e.preventDefault();var $capthacQuestion=$("#captcha-q"),$capthacAnswer=$("#captcha-a"),$username=$(".register-username"),$password=$(".register-retype"),$retype=$(".register-password");if(Number($capthacAnswer.val())===Number(eval($capthacQuestion.html()))&&$password.val()===$retype.val()){var data={username:$(".register-username").val(),password:$(".register-password").val()};$.ajax({url:"/api/user",type:"POST",data:data,success:function(a){console.log("backend.js :320",a),a.message?(toastr.success(a.message),setTimeout(function(){window.location.replace("/admin/users")},2e3)):a.err&&toastr.error(a.err)}})}else Number($capthacAnswer.val())!==Number(eval($capthacQuestion.html()))&&toastr.error("Wrong captcha!"),$password.val()!==$retype.val()&&toastr.error("Password Missmatch!"),user.captcha()},changePassword:function(a){a.preventDefault(),$(".pwd-err").removeClass("alert success"),$(".pwd-err").hide();var b={id:$(".profile-container").data("id"),oldPwd:$(".profile-old-pwd").val().trim(),newPwd:$(".profile-new-pwd").val().trim(),checkPwd:$(".profile-check-pwd").val().trim()};""===b.oldPwd||""===b.newPwd||""===b.checkPwd?$(".pwd-err").fadeIn().addClass("alert").text("Can't be empty!"):b.newPwd===b.oldPwd?$(".pwd-err").fadeIn().addClass("alert").text("Choose a new password!"):b.newPwd!==b.checkPwd?$(".pwd-err").fadeIn().addClass("alert").text("Passwords don't match!"):$.post("/api/user/"+b.id+"/password",b,function(a,b){console.log("backend.js :80",a),a.err?"success"!==a&&$(".pwd-err").fadeIn().addClass("alert").text(a.message):($(".pwd-err").fadeIn().addClass("success").text(a.message+", redirecting to login."),toastr.success("Password changed!","Redirecting to login"),setTimeout(function(){window.location.reload()},1500))})},changeInfo:function(a){a.preventDefault();var b={id:$(".profile-container").data("id"),username:$("#profile-username").val(),name:$("#profile-full-name").val(),email:$("#profile-email").val(),role:$("#profile-role").val()};$.post("/api/user/"+b.id,b,function(a,b){console.log("backend.js :90",a),"success"===a?(toastr.success("Profile Changed!"),setTimeout(function(){window.location.reload()},2e3)):toastr.error("Error while changing profile")})},requestApiToken:function(a){a.preventDefault(),a.stopPropagation();var b=$(this),c=$(this).find("input[type='text']");swal({title:"Authenticate!",text:"Type the user's password",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Write something"},function(a){return a===!1?!1:""===a?(swal.showInputError("You need to write something!"),!1):void $.ajax({url:"/api/token/generate",type:"POST",data:{user_id:b.data("id"),password:a},success:function(a,d){console.log("backend.js :156",a),c.val(a.token),b.find("button").fadeOut(),swal("Token generated",null,"success")},error:function(a){401===a.status&&swal("Wrong password!","Wrong authentication data, try again","error"),405===a.status&&swal("User have a token","User have a token yet!","error"),403===a.status&&swal("Not Authorized!",null,"error")}})})}};return $(document).ready(function(){user.init()}),user}(jQuery,this,document);